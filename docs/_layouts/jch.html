<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>{{ page.title }}</title>
  <link href="../css/bootstrap.min.css" rel="stylesheet">
  <link href="../fonts/bootstrap-icons.min.css" rel="stylesheet">
</head>
<body>
  {% include jch_header.html %}

  <main class="container py-5"
	{% if page.background %}
	style="background: linear-gradient(rgba(255,255,255,0.85), rgba(255,255,255,0.85)),
               url('{{ page.background | relative_url }}');
               background-size: cover; background-position: center;"
	{% endif %}
	>

    {{ content }}
  </main>

  {% include footer.html %}

  <script src="../js/bootstrap.bundle.min.js"></script>

  <script>
   document.addEventListener('DOMContentLoaded', function () {
       document.querySelectorAll('a.external-link').forEach(function(a){
	   try {
	       // only add for absolute URLs (optional)
	       if (a.hostname && a.hostname !== location.hostname) {
		   a.setAttribute('target','_blank');
		   a.setAttribute('rel','noopener noreferrer');
	       }
	   } catch(e){ /* defensive */ }
       });
   });

   document.addEventListener('DOMContentLoaded', function () {
       document.querySelectorAll('a.external-link-preview').forEach(link => {
	   const href = link.getAttribute('href');
	   // If the href points to an image, use it directly
	   if (/\.(jpe?g|png|gif|webp|avif|svg)$/i.test(href)) {
	       link.style.setProperty('--preview-url', `url(${href})`);
	   } else {
	       // Optional: You can add logic here to map non-image URLs
	       // (e.g., Flickr, YouTube) to preview thumbnails.
	       link.style.setProperty('--preview-url', `none`);
	   }
       });
   });

   document.addEventListener("DOMContentLoaded", () => {
       document.querySelectorAll('a.external-link-flickr').forEach(link => {
           // Match /p/ (photo) or /s/ (album)
           const match = link.href.match(/https?:\/\/(?:www\.flickr\.com|flic\.kr)\/(p|s)\/([A-Za-z0-9]+)/);
           if(match) {
               const type = match[1];  // 'p' or 's'
               const key = match[2];

               // Relative path from page
               const previewPath = `/images/flickr-previews/${key}.jpg`;

               link.style.setProperty('--flickr-preview', `url('${previewPath}')`);
               link.style.position = 'relative';

               // External link behavior
               link.setAttribute('target', '_blank');
               link.setAttribute('rel', 'noopener noreferrer');
           }
       });
   });
  </script>

</body>
</html>
